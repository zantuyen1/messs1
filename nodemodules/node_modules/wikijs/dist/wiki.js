'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=wiki;var _crossFetch=require('cross-fetch'),_crossFetch2=_interopRequireDefault(_crossFetch),_querystring=require('querystring'),_querystring2=_interopRequireDefault(_querystring),_util=require('./util'),_page=require('./page'),_page2=_interopRequireDefault(_page),_chain=require('./chain'),_chain2=_interopRequireDefault(_chain);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var defaultOptions={apiUrl:'http://en.wikipedia.org/w/api.php',origin:'*'};function wiki(){function a(s){return s.query.redirects&&1===s.query.redirects.length?(0,_util.api)(r,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:s.query.redirects[0].to}):s}function b(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50,u=2<arguments.length&&arguments[2]!==void 0&&arguments[2];return(0,_util.pagination)(r,{list:'search',srsearch:s,srlimit:t},function(v){return v.query.search.map(function(w){return u?w:w.title})}).catch(function(v){if('"text" search is disabled.'===v.message)return d(s,t);throw v})}function d(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.api)(r,{search:s,limit:t,namespace:0,action:'opensearch',redirects:void 0}).then(function(u){return u[1]})}function f(s){return(0,_util.api)(r,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',titles:s}).then(a).then(function(t){var u=Object.keys(t.query.pages)[0];if(!u||'-1'===u)throw new Error('No article found');return(0,_page2.default)(t.query.pages[u],r)})}var q=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};this instanceof wiki&&console.log('Please do not use wikijs ^1.0.0 as a class. Please see the new README.');var r=Object.assign({},defaultOptions,q);return{search:b,random:function(){var s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return(0,_util.api)(r,{list:'random',rnnamespace:0,rnlimit:s}).then(function(t){return t.query.random.map(function(u){return u.title})})},page:f,geoSearch:function(s,t){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1e3,v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:10;return(0,_util.api)(r,{list:'geosearch',gsradius:u,gscoord:s+'|'+t,gslimit:v}).then(function(w){return w.query.geosearch.map(function(x){return x.title})})},options:q,findById:function(s){return(0,_util.api)(r,{prop:'info|pageprops',inprop:'url',ppprop:'disambiguation',pageids:s}).then(a).then(function(t){var u=Object.keys(t.query.pages)[0];if(!u||'-1'===u)throw new Error('No article found');return(0,_page2.default)(t.query.pages[u],r)})},find:function(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(u){return u[0]};return b(s).then(function(u){return t(u.results)}).then(function(u){return f(u)})},allPages:function(){return(0,_util.aggregate)(r,{},'allpages','title','ap')},allCategories:function(){return(0,_util.aggregate)(r,{},'allcategories','*','ac')},pagesInCategory:function(s){return(0,_util.aggregate)(r,{cmtitle:s},'categorymembers','title','cm')},opensearch:d,prefixSearch:function(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:50;return(0,_util.pagination)(r,{list:'prefixsearch',pslimit:t,psprofile:'fuzzy',pssearch:s},function(u){return u.query.prefixsearch.map(function(v){return v.title})})},mostViewed:function(){return(0,_util.api)(r,{list:'mostviewed'}).then(function(s){return s.query.mostviewed.map(function(t){var u=t.title,v=t.count;return{title:u,count:v}})})},api:function(s){return(0,_util.api)(r,s)},chain:function(){return new _chain2.default(r)},exportXml:function(s){var u=r.apiUrl.replace('api','index')+'?'+_querystring2.default.stringify({title:'Special:Export',pages:s}),v=Object.assign({"User-Agent":'WikiJS Bot v1.0'},r.headers);return(0,_crossFetch2.default)(u,{headers:v}).then(function(w){return w.text()})}}}
//# sourceMappingURL=wiki.js.map